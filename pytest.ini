[pytest]
# === General settings ===
minversion = 7.0

# Test markers for organizing test suites
markers =
    unit: mark test as unit test
    integration: tests that contact external APIs
    e2e: end-to-end tests (MD→LaTeX→PDF pipeline)
    slow: marks tests as slow (deselect with '-m "not slow"')
    network: mark tests requiring internet (API calls)
    requires_zotero: tests requiring Zotero API credentials
    visual: visual regression tests (future use)
    manual: mark tests that need human verification

# Test discovery patterns
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Output options
addopts =
    -ra                                    # show extra test summary info
    -v                                     # verbose mode
    --color=yes                            # colorized output
    --tb=short                             # shorter tracebacks
    --strict-markers                       # error on unknown markers
    --cov=src                              # coverage of src/ only
    --cov-report=term-missing:skip-covered # show uncovered lines
    --cov-report=xml:coverage.xml          # XML for CI
    --cov-report=html:coverage_html        # HTML for local viewing
    --junitxml=test-results.xml            # JUnit XML for CI

# Logging
log_cli = false
log_cli_level = INFO
log_file = tests/test.log
log_file_level = DEBUG

# Coverage configuration
[coverage:run]
source = src
branch = True
omit =
    */tests/*
    */test_*.py
    */__init__.py
    */venv/*
    */.venv/*

[coverage:report]
precision = 2
show_missing = True
skip_covered = True
exclude_lines =
    pragma: no cover
    if __name__ == .__main__.:
    raise NotImplementedError
    pass
fail_under = 85
